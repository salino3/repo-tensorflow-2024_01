<html>
  <head>
    <meta charset="UTF-8" />
    <title>Classificador imagenes con MobileNet p5.js</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/addons/p5.dom.min.js"></script>

    <script
      src="https://unpkg.com/ml5@0.2.2/dist/ml5.min.js"
      type="text/javascript"
    ></script>
    <style>
      button {
        margin: 2px;
        padding: 4px;
      }
      video {
        width: 300;
        height: 300;
      }
      p {
        display: inline;
        font-size: 14px;
      }
      h6 {
        margin: 4px;
        font-weight: lighter;
        font-size: 14px;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body>
    <h2>
      Clasificador deimagenes usando el extractor de caracteristicas con
      mobilenet
    </h2>
    <div id="contenedorVideo"></div>
    <h6>
      <span id="estadoModelo">Cargando modelo base...</span> |
      <span id="estadoVideo">Cargando video...</span>
    </h6>
    <p><button id="botonBrocha">Agregar imagen de brocha</button></p>
    <p><span id="sumaDeImagenesBrocha">0</span> imagenes de brocha</p>
    <br /><button id="botonTaza">Agregar imagen de taza</button>
    <p><span id="sumaDeImagenesTaza">0</span> imagenes de taza</p>
    <br />
    <button id="botonEntrenamiento">Entrenamiento</button
    ><span id="perdida"></span>
    <br />
    <p>
      <button id="botonPredecir">Iniciar la prediccion!</button><br />
      Esto es: <span id="result">...</span>, Con una certeza del
      <span id="confidence">...</span>.
    </p>
    <script>
      let video;
      let featureExtractor;
      let classificador;
      let brochaImagenes = 0;
      let tazaImagenes = 0;
      let perdida;
      function setup() {
        noCanvas();
        video = createCapture(VIDEO);
        video.parent("contenedorVideo");
        featureExtractor = ml5.featureExtractor("MobileNet", modeloListo);
        classificador = featureExtractor.classification(video, videoListo);
        configuraBotones();
      }
      function modeloListo() {
        const estadoModelo = select("#estadoModelo");
        if (estadoModelo) {
          estadoModelo.html("modelo cargado");
        } else {
          console.error("Element with id 'estadoModelo' not found.");
        }
      }
      function videoListo() {
        const estadoModelo = select("#estadoModelo");
        if (estadoModelo) {
          estadoModelo.html("video cargado");
        } else {
          console.error("Element with id 'estadoModelo' not found.");
        }
      }
      function configuraBotones() {
        botonA = select("#botonBrocha");
        botonA.mousePressed(function () {
          classificador.addImage("brocha");
          select("#sumaDeImagenesBrocha").html(++brochaImagenes);
        });

        botonB = select("#botonTaza");
        botonB.mousePressed(function () {
          classificador.addImage("taza");
          select("#sumaDeImagenesTaza").html(++tazaImagenes);
        });

        botonEntrenamiento = select("#botonEntrenamiento");
        botonEntrenamiento.mousePressed(function () {
          classificador.train(function (valorPerdida) {
            if (valorPerdida) {
              perdida = valorPerdida;
              select("#perdida").html("Perdida: " + perdida);
            } else {
              select("#perdida").html(
                "Entrenamiento finalizado con una perdida de " + perdida
              );
            }
          });
        });

        botonPredecir = select("#botonPredecir");
        botonPredecir.mousePressed(function () {
          classificador.classify(mostrarResultado);
        });
      }
      function mostrarResultado(err, res) {
        select("#result").html(res[0].label);
        select("#confidence").html(res[0].confidence.toFixed(2));
        setTimeout(() => {
          classificador.classify(mostrarResultado);
        }, 200);
      }
    </script>
  </body>
</html>

<!-- vi video 4 https://www.youtube.com/watch?v=VKxsEuvaW0U&t=26s -->
